<h2 mat-dialog-title>Resumen de Cuenta</h2>

<mat-dialog-content>
  <div class="client-card">
    <div class="client-header">
      <div class="icon-circle"><mat-icon>person</mat-icon></div>
      <div class="client-meta">
        <div class="eyebrow">Cliente de la venta</div>
        <div class="client-name">{{ clienteLabel() }}</div>
        <div class="client-note" *ngIf="selectedClientId() === 'anon'">Sin identificación</div>
        <div class="client-note" *ngIf="selectedClientId() !== 'anon'">Puedes cambiarlo antes de cobrar</div>
      </div>
    </div>

    <mat-form-field appearance="outline" class="client-field">
      <mat-label>Cambiar cliente</mat-label>
      <mat-select [value]="selectedClientId()" (selectionChange)="onClienteChange($event.value)">
        <mat-option value="anon">Consumidor final</mat-option>
        <mat-option>
          <mat-form-field appearance="outline" class="search-field">
            <mat-label>Buscar nombre o cédula</mat-label>
            <input matInput [(ngModel)]="clientSearch" />
          </mat-form-field>
        </mat-option>
        @for (c of filteredClients(); track c.id) {
          <mat-option class="client-option" [value]="c.id">{{ c.nombre }}{{ c.cedula ? ' · ' + c.cedula : '' }}</mat-option>
        }
      </mat-select>
    </mat-form-field>
  </div>

  <mat-divider class="section-divider"></mat-divider>
  
  <mat-list>
    @for (linea of cartService.items(); track $index) {
      <mat-list-item class="item-lista">
        
        <button mat-icon-button matListItemAvatar color="warn" (click)="eliminar($index)">
          <mat-icon>delete</mat-icon>
        </button>

        <div matListItemTitle class="titulo">
          {{ linea.item.nombre }} <span class="cantidad">x{{ linea.cantidad }}</span>
        </div>

        <div matListItemLine class="detalle-precio">
          Precio Unit: ${{ linea.precioVenta }}
        </div>
        
        <div matListItemMeta class="subtotal">
          ${{ linea.subtotal | number:'1.2-2' }}
        </div>

      </mat-list-item>
      <mat-divider></mat-divider>
    }
  </mat-list>

  <div class="total-container">
    <span>TOTAL:</span>
    <span class="monto-total">${{ cartService.total() | number:'1.2-2' }}</span>
  </div>

</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="cerrar()">SEGUIR AGREGANDO</button>
  <button mat-raised-button color="primary" class="btn-cobrar" (click)="cobrar()">
    COBRAR
  </button>
</mat-dialog-actions>