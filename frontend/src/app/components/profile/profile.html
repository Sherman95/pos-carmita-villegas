<div class="main-layout fade-in">
  
  <div class="header-bg"></div> <div class="content-wrapper">

    <aside class="profile-sidebar">
      @if (user(); as u) {
        <div class="identity-card">
          <div class="avatar-container">
            <div class="avatar-circle">{{ (u.username || 'U')[0] | uppercase }}</div>
            <div class="status-indicator" matTooltip="Online"></div>
          </div>
          <div class="user-info">
            <h2>{{ u.username }}</h2>
            <span class="role-pill">{{ u.role || 'Admin' }}</span>
          </div>
          <div class="sidebar-actions">
            <button mat-flat-button color="warn" class="logout-btn" (click)="logout()">
              <mat-icon>logout</mat-icon> Cerrar Sesión
            </button>
          </div>
        </div>
      }
    </aside>

    <main class="profile-forms">
      
      <div class="section-header">
        <h1>Configuración</h1>
        <p>Actualiza la información de tu negocio</p>
      </div>

      <div class="form-card">
        <div class="card-header-styled biz-header">
          <div class="icon-wrapper"><mat-icon>storefront</mat-icon></div>
          <h3>Datos del Negocio (Recibos)</h3>
        </div>

        <div class="card-content">
          <form (ngSubmit)="saveBusiness()" autocomplete="off">
            
            <div class="form-grid-row">
              <mat-form-field appearance="fill" class="modern-input col-full">
                <mat-label>Nombre Comercial</mat-label>
                <input matInput [(ngModel)]="business().name" name="bizName" placeholder="Ej. Tienda Carmita" />
                <mat-icon matSuffix>badge</mat-icon>
              </mat-form-field>
            </div>

            <div class="form-grid-row">
              <mat-form-field appearance="fill" class="modern-input col-half">
                <mat-label>RUC / CI</mat-label>
                <input matInput [(ngModel)]="business().ruc" name="bizRuc" />
              </mat-form-field>

              <mat-form-field appearance="fill" class="modern-input col-half">
                <mat-label>Teléfono</mat-label>
                <input matInput [(ngModel)]="business().phone" name="bizPhone" />
                <mat-icon matSuffix>phone</mat-icon>
              </mat-form-field>
            </div>

            <div class="form-grid-row">
              <mat-form-field appearance="fill" class="modern-input col-full">
                <mat-label>Dirección</mat-label>
                <input matInput [(ngModel)]="business().address" name="bizAddress" />
                <mat-icon matSuffix>location_on</mat-icon>
              </mat-form-field>
            </div>

            <div class="tax-box">
              <div class="tax-text">
                <strong>Impuesto (IVA)</strong>
                <span>Valor en decimal (0.15 = 15%)</span>
              </div>
              <input type="number" step="0.01" class="tax-field-mini"
                 [ngModel]="taxRateInput()" 
                 (ngModelChange)="taxRateInput.set($event)"
                 name="bizIva" />
            </div>

            <button mat-flat-button color="primary" type="submit" class="btn-save">
              GUARDAR CAMBIOS
            </button>

            @if (message() && message().includes('Sincronizado')) {
              <div class="feedback-msg success">
                <mat-icon>check_circle</mat-icon> {{ message() }}
              </div>
            }
          </form>
        </div>
      </div>

      <div class="form-card">
        <div class="card-header-styled user-header">
          <div class="icon-wrapper"><mat-icon>manage_accounts</mat-icon></div>
          <h3>Cuenta de Usuario</h3>
        </div>

        <div class="card-content">
          <form (ngSubmit)="save()" autocomplete="off">
            <div class="form-grid-row">
              <mat-form-field appearance="fill" class="modern-input col-full">
                <mat-label>Nombre de Usuario</mat-label>
                <input matInput [(ngModel)]="username" name="username" required />
                <mat-icon matSuffix>person</mat-icon>
              </mat-form-field>
            </div>
            
            <button mat-stroked-button color="primary" type="submit" class="btn-save" style="box-shadow: none;">
              ACTUALIZAR USUARIO
            </button>

            @if (message() && message().includes('nombre')) {
              <div class="feedback-msg info">
                <mat-icon>info</mat-icon> {{ message() }}
              </div>
            }
          </form>
        </div>
      </div>

    </main>
  </div>
</div>