<div class="page-container">
  
  <header class="header-section">
    <div class="header-content">
      <h1>Perfil de Usuario </h1>
      <p>Configura tu cuenta y los datos del negocio</p>
    </div>
  </header>

  <div class="profile-container">

    @if (user(); as u) {
      
      <div class="identity-card elevation-z4">
        <div class="avatar-circle">
          {{ (u.username || 'U')[0] | uppercase }}
        </div>
        <div class="identity-info">
          <h2 class="username">{{ u.username }}</h2>
          <span class="role-badge">{{ u.role || 'Usuario' }}</span>
          <div class="status">
            <span class="dot"></span> Sesi贸n activa
          </div>
        </div>
        <button mat-icon-button color="warn" class="btn-logout-icon" (click)="logout()" matTooltip="Cerrar sesi贸n">
           <mat-icon>logout</mat-icon>
        </button>
      </div>

      <div class="grid-layout">
        
        <mat-card class="section-card">
          <div class="card-header">
            <mat-icon>manage_accounts</mat-icon> Datos de Cuenta
          </div>
          <div class="card-body">
            <form (ngSubmit)="save()" autocomplete="off" class="form-grid">
              
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Nombre de usuario (Local)</mat-label>
                <input matInput [(ngModel)]="username" name="username" required />
                <mat-hint>Visible solo en este dispositivo</mat-hint>
              </mat-form-field>

              <div class="actions">
                <button mat-flat-button color="primary" type="submit">
                  GUARDAR CAMBIOS
                </button>
              </div>
            </form>
          </div>
        </mat-card>

        <mat-card class="section-card">
          <div class="card-header">
            <mat-icon>storefront</mat-icon> Datos del Negocio
            <small>(Para imprimir en recibos)</small>
          </div>
          <div class="card-body">
            <form (ngSubmit)="saveBusiness()" autocomplete="off" class="form-grid">
              
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Nombre Comercial</mat-label>
                <input matInput [(ngModel)]="business().name" name="bizName" placeholder="Ej. Est茅tica Carmita" />
                <mat-icon matSuffix>badge</mat-icon>
              </mat-form-field>

              <div class="row-inputs">
                <mat-form-field appearance="outline" class="half">
                  <mat-label>RUC / CI</mat-label>
                  <input matInput [(ngModel)]="business().ruc" name="bizRuc" />
                </mat-form-field>

                <mat-form-field appearance="outline" class="half">
                  <mat-label>Tel茅fono</mat-label>
                  <input matInput [(ngModel)]="business().phone" name="bizPhone" />
                </mat-form-field>
              </div>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Direcci贸n</mat-label>
                <input matInput [(ngModel)]="business().address" name="bizAddress" />
                <mat-icon matSuffix>place</mat-icon>
              </mat-form-field>

              <mat-form-field appearance="outline" class="full-width">
                  <mat-label>IVA (Decimal)</mat-label>
  
                  <input matInput type="number" step="0.01" 
                   [ngModel]="taxRateInput()" 
                  (ngModelChange)="taxRateInput.set($event)"
                  name="bizIva" 
                 placeholder="0.15" />

            <mat-hint>Ejemplo: 0.15 para 15%</mat-hint>
           <span matPrefix>% &nbsp;</span>
          </mat-form-field>

              <div class="actions">
                <button mat-stroked-button color="primary" type="submit">
                  ACTUALIZAR DATOS
                </button>
              </div>

              @if (message()) {
                <div class="success-msg">
                  <mat-icon>check_circle</mat-icon> {{ message() }}
                </div>
              }
            </form>
          </div>
        </mat-card>

        <button mat-stroked-button color="warn" class="btn-logout-mobile" (click)="logout()">
          <mat-icon>logout</mat-icon> CERRAR SESIN
        </button>

      </div>

    } @else {
      <div class="empty-state">
        <mat-icon>no_accounts</mat-icon>
        <h2>No se encontr贸 usuario</h2>
        <button mat-flat-button color="primary" (click)="logout()">IR A LOGIN</button>
      </div>
    }

  </div>
</div>