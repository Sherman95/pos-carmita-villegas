<div class="page-container">
  
  <header class="header-section">
    <div class="header-content">
      <h1>Clientes ðŸ‘¥</h1>
      <p>Gestiona tu base de datos</p>
      
      <div class="search-box">
        <mat-icon class="search-icon">search</mat-icon>
        <input type="text" 
               placeholder="Buscar por nombre, cÃ©dula o email..." 
               [ngModel]="searchTerm()" 
               (ngModelChange)="setSearch($event)">
        
        @if (searchTerm()) {
          <button mat-icon-button (click)="setSearch('')">
            <mat-icon>close</mat-icon>
          </button>
        }
      </div>

      <button mat-flat-button class="btn-add" (click)="showCreateForm()">
        <mat-icon>add</mat-icon> NUEVO CLIENTE
      </button>
    </div>
  </header>

  <div class="list-container">
    
    @if (loading()) {
      <div class="state-message">Cargando clientes...</div>
    } @else if (filteredClients().length === 0) {
      <div class="state-message empty">
        <mat-icon>person_off</mat-icon>
        <p>No se encontraron clientes.</p>
      </div>
    } @else {
      @for (c of filteredClients(); track c.id) {
        <div class="client-card elevation-z2" (click)="editClient(c)">
          
          <div class="card-content">
            <div class="avatar-circle">
              {{ c.nombre.charAt(0).toUpperCase() }}
            </div>

            <div class="text-info">
              <span class="name">{{ c.nombre }}</span>
              <span class="details">
                <mat-icon class="tiny-icon">badge</mat-icon> {{ c.cedula || 'S/N' }}
              </span>
              <span class="details secondary">
                {{ c.telefono || 'Sin cel' }} Â· {{ c.email || 'Sin email' }}
              </span>
            </div>
          </div>

          <div class="actions">
            <button mat-icon-button color="warn" (click)="deleteClient(c.id); $event.stopPropagation()">
              <mat-icon>delete_outline</mat-icon>
            </button>
          </div>
        </div>
      }
    }
  </div>

  <ng-template #clientFormDialog>
  <div class="dialog-header-modern">
    <h2 mat-dialog-title>{{ selectedClientId() ? 'Editar Cliente ðŸ‘¤' : 'Nuevo Cliente âœ¨' }}</h2>
    <button mat-icon-button mat-dialog-close tabindex="-1" class="close-btn">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <mat-dialog-content class="modern-content">
    <p class="subtitle">InformaciÃ³n de contacto y facturaciÃ³n.</p>

    <div class="form-grid-2">
      
      <mat-form-field appearance="outline" class="col-span-2">
        <mat-label>Nombre Completo</mat-label>
        <mat-icon matPrefix>person</mat-icon>
        <input matInput [ngModel]="form().nombre" (ngModelChange)="updateField('nombre', $event)" placeholder="Ej. MarÃ­a PÃ©rez" required />
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>CÃ©dula / RUC</mat-label>
        <mat-icon matPrefix>badge</mat-icon>
        <input matInput [ngModel]="form().cedula" (ngModelChange)="updateField('cedula', $event)" placeholder="Opcional" />
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>TelÃ©fono</mat-label>
        <mat-icon matPrefix>phone</mat-icon>
        <input matInput [ngModel]="form().telefono" (ngModelChange)="updateField('telefono', $event)" placeholder="099..." />
      </mat-form-field>

      <mat-form-field appearance="outline" class="col-span-2">
        <mat-label>Correo ElectrÃ³nico</mat-label>
        <mat-icon matPrefix>mail</mat-icon>
        <input matInput [ngModel]="form().email" (ngModelChange)="updateField('email', $event)" placeholder="cliente@email.com" />
      </mat-form-field>

      <mat-form-field appearance="outline" class="col-span-2">
        <mat-label>DirecciÃ³n</mat-label>
        <mat-icon matPrefix>place</mat-icon>
        <input matInput [ngModel]="form().direccion" (ngModelChange)="updateField('direccion', $event)" placeholder="Calle principal..." />
      </mat-form-field>

    </div>
  </mat-dialog-content>

  <mat-dialog-actions align="end" class="modern-actions">
    <button mat-button mat-dialog-close (click)="cancelar()">Cancelar</button>
    <button mat-flat-button color="primary" (click)="guardar()" [disabled]="!form().nombre">
      {{ selectedClientId() ? 'Actualizar' : 'Guardar Cliente' }}
    </button>
  </mat-dialog-actions>
</ng-template>

</div>