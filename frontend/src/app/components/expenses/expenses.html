<div class="expenses-container">
  
  <div class="header-section">
    <div class="total-card elevation-z2">
      <div class="label">Total Gastado</div>
      <div class="amount">{{ totalAmount | currency }}</div>
    </div>
    
    <button mat-fab extended color="primary" (click)="openAddDialog()">
      <mat-icon>add</mat-icon> Nuevo Gasto
    </button>
  </div>

  <div class="filters-section">
    <mat-tab-group animationDuration="0ms" (selectedIndexChange)="onTabChange($event)">
      <mat-tab label="Todos"></mat-tab>
      <mat-tab label="üè† Local"></mat-tab>
      <mat-tab label="üë§ Personal"></mat-tab>
    </mat-tab-group>

    <mat-form-field appearance="outline" class="search-field">
      <mat-icon matPrefix>search</mat-icon>
      <input matInput placeholder="Buscar (ej: Taxis, Cole...)" [(ngModel)]="searchTerm" (keyup)="applyFilters()">
    </mat-form-field>
  </div>

  <div class="timeline-container">
    
    <div *ngIf="loading" class="state-msg">Cargando gastos...</div>
    <div *ngIf="!loading && groupedExpenses.length === 0" class="state-msg">
      <mat-icon>savings</mat-icon> No hay gastos aqu√≠.
    </div>

    <div *ngFor="let group of groupedExpenses" class="date-group">
      
      <div class="date-header">
        <span class="the-date">{{ group.date | date:'EEEE d MMMM' }}</span>
        <span class="day-total">D√≠a: {{ group.total | currency }}</span>
      </div>

      <div class="items-list">
        <div *ngFor="let item of group.items" class="expense-row">
          
          <div class="col-icon">
            <div class="icon-circle" [ngClass]="getColor(item.categoria)">
              <mat-icon>{{ getIcon(item.categoria) }}</mat-icon>
            </div>
          </div>

          <div class="col-info">
            <div class="desc">{{ item.descripcion || 'Sin descripci√≥n' }}</div>
            <div class="cat-badge" [ngClass]="getColor(item.categoria)">
              {{ item.categoria.replace('_', ' ') }}
            </div>
          </div>

          <div class="col-method">
            <span *ngIf="item.metodo_pago === 'TRANSFERENCIA'" class="tag-bank">üè¶ Banco</span>
            <span *ngIf="item.metodo_pago === 'EFECTIVO'" class="tag-cash">üíµ Caja</span>
          </div>

          <div class="col-amount">
            <span class="value">-{{ item.monto | currency }}</span>
            <button mat-icon-button color="warn" (click)="deleteExpense(item.id)">
              <mat-icon>delete</mat-icon>
            </button>
          </div>

        </div>
      </div>
    </div>

  </div>
</div>